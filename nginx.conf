server {
    # Listen on the default port 80
    listen 80;

    # --- Serve the React Frontend ---
    # The root directory where NGINX will find the static files
    root /usr/share/nginx/html;
    # The default file to serve
    index index.html;

    # This location block handles all requests that are not for the API
    location / {
        # This is a crucial line for single-page applications like React.
        # It ensures that if a user refreshes a page on a route like /login,
        # NGINX serves index.html, allowing the React router to handle the request.
        try_files $uri $uri/ /index.html;
    }

    # --- Reverse Proxy for the Backend API ---
    # This location block handles all requests that start with /api
    location /api/ {
        # This forwards the request to your backend service.
        # 'backend' is the name of your backend service in docker-compose.yaml.
        # The port 5000 is where your Node.js server is running.
        proxy_pass http://backend:5000/;

        # These headers help pass along the original request information
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}